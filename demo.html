<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八達通O! ePay支付平台演示</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2563eb;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: #666;
        }

        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .quick-payments {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .quick-payment {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-payment:hover {
            border-color: #2563eb;
            background-color: #eff6ff;
        }

        .quick-payment h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .quick-payment .price {
            color: #2563eb;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        .btn {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            background-color: #1d4ed8;
        }

        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }

        .payment-page {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .payment-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .octopus-logo {
            width: 50px;
            height: 50px;
            background-color: #2563eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .countdown {
            text-align: right;
        }

        .countdown .time {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc2626;
        }

        .payment-details {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .payment-details h3 {
            margin-bottom: 15px;
            color: #374151;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .detail-row:last-child {
            margin-bottom: 0;
        }

        .qr-section {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .qr-code {
            text-align: center;
            margin: 20px 0;
        }

        .qr-code canvas {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }

        .payment-token {
            text-align: center;
            margin: 20px 0;
        }

        .payment-token .token {
            font-size: 2rem;
            font-weight: bold;
            font-family: monospace;
            color: #374151;
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            display: inline-block;
            margin: 10px 0;
        }

        .status-section {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .status-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .status-pending { color: #f59e0b; }
        .status-completed { color: #10b981; }
        .status-failed { color: #ef4444; }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn-secondary {
            background-color: #6b7280;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .btn-success {
            background-color: #10b981;
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .instructions {
            background-color: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #0c4a6e;
            margin-bottom: 10px;
        }

        .instructions ul {
            color: #0c4a6e;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .footer {
            text-align: center;
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 30px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>八達通O! ePay支付平台演示</h1>
            <p>完全模擬八達通官方支付頁面的功能和界面</p>
        </div>

        <!-- 演示頁面 -->
        <div id="demoPage" class="demo-section">
            <h2>快速支付選項</h2>
            <div class="quick-payments">
                <div class="quick-payment" onclick="selectQuickPayment('MyTV Super 月費', 78.0)">
                    <h3>MyTV Super 月費</h3>
                    <div class="price">HKD $78.0</div>
                </div>
                <div class="quick-payment" onclick="selectQuickPayment('Netflix 月費', 93.0)">
                    <h3>Netflix 月費</h3>
                    <div class="price">HKD $93.0</div>
                </div>
                <div class="quick-payment" onclick="selectQuickPayment('Spotify 月費', 48.0)">
                    <h3>Spotify 月費</h3>
                    <div class="price">HKD $48.0</div>
                </div>
                <div class="quick-payment" onclick="selectQuickPayment('Apple Music 月費', 58.0)">
                    <h3>Apple Music 月費</h3>
                    <div class="price">HKD $58.0</div>
                </div>
            </div>

            <h2>自定義支付</h2>
            <form id="paymentForm">
                <div class="form-group">
                    <label for="description">商品描述 *</label>
                    <textarea id="description" rows="3" placeholder="請描述您要購買的商品或服務" required></textarea>
                </div>
                <div class="form-group">
                    <label for="amount">金額 (HKD) *</label>
                    <input type="number" id="amount" step="0.1" min="0.1" placeholder="0.0" required>
                </div>
                <div class="form-group">
                    <label for="customerEmail">客戶郵箱</label>
                    <input type="email" id="customerEmail" placeholder="customer@example.com">
                </div>
                <div class="form-group">
                    <label for="customerPhone">客戶電話</label>
                    <input type="tel" id="customerPhone" placeholder="+852 1234 5678">
                </div>
                <button type="submit" class="btn">創建訂單並支付</button>
            </form>
        </div>

        <!-- 支付頁面 -->
        <div id="paymentPage" class="payment-page">
            <div class="payment-header">
                <div class="payment-title">
                    <div class="octopus-logo">八</div>
                    <div>
                        <h1>八達通網上付款服務</h1>
                        <p>多謝使用八達通網上付款服務</p>
                    </div>
                </div>
                <div class="countdown">
                    <p>尚餘時間</p>
                    <div class="time" id="countdown">05:00</div>
                </div>
            </div>

            <div class="instructions">
                <h3>重要：</h3>
                <p>請勿關閉或離開此網頁，它會在付款狀態改變時自動更新。</p>
            </div>

            <div class="payment-details">
                <h3>付款詳情</h3>
                <div class="detail-row">
                    <span>商戶名稱</span>
                    <span>測試商戶</span>
                </div>
                <div class="detail-row">
                    <span>金額</span>
                    <span id="paymentAmount">HKD $0.0</span>
                </div>
                <div class="detail-row">
                    <span>商品描述</span>
                    <span id="paymentDescription">-</span>
                </div>
            </div>

            <div class="qr-section">
                <h3>透過八達通App使用八達通卡或八達通銀包付款</h3>
                <p>如你的流動裝置已下載八達通App，可選擇以下付款方法：</p>
                <ul>
                    <li>八達通卡</li>
                    <li>八達通銀包</li>
                </ul>
                <p>請開啟八達通App，並掃瞄以下QR Code或輸入以下付款編號。</p>

                <div class="qr-code">
                    <p>掃描QR Code，或</p>
                    <canvas id="qrCanvas"></canvas>
                </div>

                <div class="payment-token">
                    <p>輸入付款編號</p>
                    <div class="token" id="paymentToken">-</div>
                </div>
            </div>

            <div class="status-section">
                <div class="status-icon status-pending" id="statusIcon">⏰</div>
                <div id="statusText">等待支付</div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-success" onclick="simulatePayment()">模擬支付成功（測試用）</button>
                <button class="btn btn-secondary" onclick="cancelPayment()">取消交易</button>
            </div>

            <div class="instructions">
                <h3>支付說明：</h3>
                <ul>
                    <li>請確保您的八達通App已更新至最新版本</li>
                    <li>掃描QR Code後請在App中確認支付</li>
                    <li>支付完成後頁面會自動更新狀態</li>
                    <li>如有問題請聯繫客服</li>
                </ul>
            </div>

            <div class="footer">
                © 2024 八達通卡有限公司。版權所有。
            </div>
        </div>
    </div>

    <script>
        let currentPayment = null;
        let countdownInterval = null;
        let timeRemaining = 300; // 5分鐘

        // 選擇快速支付
        function selectQuickPayment(description, amount) {
            document.getElementById('description').value = description;
            document.getElementById('amount').value = amount;
        }

        // 表單提交
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const customerEmail = document.getElementById('customerEmail').value;
            const customerPhone = document.getElementById('customerPhone').value;

            if (!description || !amount) {
                alert('請填寫所有必填欄位');
                return;
            }

            createPayment(description, amount, customerEmail, customerPhone);
        });

        // 創建支付
        function createPayment(description, amount, customerEmail, customerPhone) {
            // 顯示載入狀態
            document.getElementById('demoPage').style.display = 'none';
            document.getElementById('paymentPage').style.display = 'block';
            
            // 生成付款編號
            const paymentToken = generatePaymentToken();
            
            // 創建支付數據
            currentPayment = {
                id: generateId(),
                description: description,
                amount: amount,
                customerEmail: customerEmail,
                customerPhone: customerPhone,
                paymentToken: paymentToken,
                status: 'pending',
                createdAt: new Date()
            };

            // 更新支付頁面
            updatePaymentPage();
            
            // 生成QR Code
            generateQRCode(paymentToken);
            
            // 開始倒計時
            startCountdown();
        }

        // 更新支付頁面
        function updatePaymentPage() {
            document.getElementById('paymentAmount').textContent = `HKD $${currentPayment.amount.toFixed(1)}`;
            document.getElementById('paymentDescription').textContent = currentPayment.description;
            document.getElementById('paymentToken').textContent = currentPayment.paymentToken;
        }

        // 生成付款編號
        function generatePaymentToken() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < 7; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // 生成ID
        function generateId() {
            return 'payment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // 生成QR Code
        function generateQRCode(token) {
            const qrData = `https://www.online-octopus.com/oos/payment/?token=${token}`;
            const canvas = document.getElementById('qrCanvas');
            
            QRCode.toCanvas(canvas, qrData, {
                width: 300,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF',
                }
            }, function (error) {
                if (error) {
                    console.error('生成QR Code錯誤:', error);
                    canvas.getContext('2d').fillText('QR Code生成失敗', 10, 50);
                }
            });
        }

        // 開始倒計時
        function startCountdown() {
            timeRemaining = 300; // 5分鐘
            updateCountdownDisplay();
            
            countdownInterval = setInterval(() => {
                timeRemaining--;
                updateCountdownDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(countdownInterval);
                    alert('支付時間已過期，請重新創建訂單');
                    resetToDemo();
                }
            }, 1000);
        }

        // 更新倒計時顯示
        function updateCountdownDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('countdown').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // 模擬支付
        function simulatePayment() {
            if (!currentPayment) return;
            
            currentPayment.status = 'completed';
            updatePaymentStatus();
            
            // 停止倒計時
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            alert('支付成功！');
        }

        // 更新支付狀態
        function updatePaymentStatus() {
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            
            switch (currentPayment.status) {
                case 'pending':
                    statusIcon.textContent = '⏰';
                    statusIcon.className = 'status-icon status-pending';
                    statusText.textContent = '等待支付';
                    break;
                case 'completed':
                    statusIcon.textContent = '✅';
                    statusIcon.className = 'status-icon status-completed';
                    statusText.textContent = '支付成功';
                    break;
                case 'failed':
                    statusIcon.textContent = '❌';
                    statusIcon.className = 'status-icon status-failed';
                    statusText.textContent = '支付失敗';
                    break;
            }
        }

        // 取消支付
        function cancelPayment() {
            if (confirm('確定要取消交易嗎？')) {
                resetToDemo();
            }
        }

        // 重置到演示頁面
        function resetToDemo() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            currentPayment = null;
            timeRemaining = 300;
            
            document.getElementById('paymentPage').style.display = 'none';
            document.getElementById('demoPage').style.display = 'block';
            
            // 清空表單
            document.getElementById('paymentForm').reset();
        }

        // 複製付款編號
        function copyPaymentToken() {
            if (currentPayment && currentPayment.paymentToken) {
                navigator.clipboard.writeText(currentPayment.paymentToken);
                alert('付款編號已複製到剪貼板');
            }
        }

        // 為付款編號添加點擊複製功能
        document.addEventListener('DOMContentLoaded', function() {
            const tokenElement = document.getElementById('paymentToken');
            if (tokenElement) {
                tokenElement.style.cursor = 'pointer';
                tokenElement.title = '點擊複製';
                tokenElement.addEventListener('click', copyPaymentToken);
            }
        });
    </script>
</body>
</html>
